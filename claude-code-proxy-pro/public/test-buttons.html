<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>按钮功能测试</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 8px;
        }
        .error-log {
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            color: var(--error);
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-results {
            margin-top: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        .test-pass {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        .test-fail {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }
    </style>
</head>
<body>
    <h1>Claude Code Proxy Pro - 按钮功能测试</h1>
    
    <div class="test-section">
        <h2>测试按钮</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button id="testBtn1" class="btn btn-primary">主要按钮</button>
            <button id="testBtn2" class="btn btn-secondary">次要按钮</button>
            <button id="testBtn3" class="btn btn-success">成功按钮</button>
            <button id="testBtn4" class="btn btn-outline">轮廓按钮</button>
            <button id="testBtn5" class="btn btn-primary" disabled>禁用按钮</button>
        </div>
    </div>

    <div class="test-section">
        <h2>错误日志</h2>
        <div id="errorLog" class="error-log">等待错误信息...</div>
    </div>

    <div class="test-section">
        <h2>测试结果</h2>
        <div id="testResults" class="test-results"></div>
    </div>

    <script>
        // 错误日志收集
        const errorLog = document.getElementById('errorLog');
        const testResults = document.getElementById('testResults');
        let errors = [];

        // 捕获全局错误
        window.addEventListener('error', (event) => {
            const error = {
                message: event.message,
                source: event.filename,
                line: event.lineno,
                column: event.colno,
                error: event.error
            };
            errors.push(error);
            displayError(error);
        });

        // 捕获未处理的Promise拒绝
        window.addEventListener('unhandledrejection', (event) => {
            const error = {
                message: 'Unhandled Promise Rejection',
                reason: event.reason,
                promise: event.promise
            };
            errors.push(error);
            displayError(error);
        });

        function displayError(error) {
            const errorText = `[${new Date().toLocaleTimeString()}] ${JSON.stringify(error, null, 2)}\n`;
            errorLog.textContent += errorText;
            errorLog.scrollTop = errorLog.scrollHeight;
        }

        // 测试函数
        function addTestResult(test, passed, message = '') {
            const result = document.createElement('div');
            result.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            result.textContent = `${passed ? '✅' : '❌'} ${test}: ${message || (passed ? 'PASSED' : 'FAILED')}`;
            testResults.appendChild(result);
        }

        // 开始测试
        function runTests() {
            testResults.innerHTML = '';
            
            // 测试1: 检查是否存在 electronAPI
            addTestResult('electronAPI 存在性', typeof window.electronAPI !== 'undefined', 
                window.electronAPI ? 'electronAPI 已定义' : 'electronAPI 未定义');

            // 测试2: 检查按钮是否可点击
            const testBtns = document.querySelectorAll('[id^="testBtn"]');
            testBtns.forEach((btn, index) => {
                try {
                    btn.addEventListener('click', () => {
                        addTestResult(`按钮${index + 1}点击事件`, true, `${btn.textContent} 被点击`);
                    });
                    addTestResult(`按钮${index + 1}事件绑定`, true, '事件监听器已添加');
                } catch (e) {
                    addTestResult(`按钮${index + 1}事件绑定`, false, e.message);
                }
            });

            // 测试3: 检查 DOM 元素获取
            const elementsToCheck = [
                'checkEnvBtn', 'toggleApiKey', 'saveEnvBtn', 'testEnvBtn', 
                'startClaudeBtn', 'openTerminalBtn', 'copyEnvBtn', 
                'exportScriptBtn', 'resetConfigBtn'
            ];

            elementsToCheck.forEach(id => {
                const element = document.getElementById(id);
                addTestResult(`DOM元素 #${id}`, !!element, 
                    element ? '元素存在' : '元素不存在');
            });

            // 测试4: 检查 CSS 加载
            const testBtn = document.getElementById('testBtn1');
            const computedStyle = window.getComputedStyle(testBtn);
            const hasStyles = computedStyle.padding !== '0px' && computedStyle.cursor === 'pointer';
            addTestResult('CSS 样式加载', hasStyles, 
                hasStyles ? '样式已正确加载' : '样式加载失败');

            // 测试5: 检查脚本加载顺序
            addTestResult('error-handler.js 加载', typeof window.ErrorHandler !== 'undefined',
                window.ErrorHandler ? 'ErrorHandler 已定义' : 'ErrorHandler 未定义');

            // 显示错误数量
            if (errors.length === 0) {
                errorLog.textContent = '没有捕获到任何错误 ✅';
            }
        }

        // 延迟执行测试，确保页面完全加载
        setTimeout(runTests, 1000);

        // 测试按钮点击
        document.getElementById('testBtn1').addEventListener('click', () => {
            console.log('Primary button clicked');
        });
    </script>
</body>
</html>